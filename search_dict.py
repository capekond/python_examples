d = [{'business_day': '20131218', 'snapshot_type': 'EOD', 'snapshot_time': '23:00', 'snapshot_date': '20131218',
      'unique_contract_id': '21', 'value': '460.19', 'value_creation_timestamp': '1387324800000'},
     {'business_day': '20131218', 'snapshot_type': 'EOD', 'snapshot_time': '23:00', 'snapshot_date': '20131218',
      'unique_contract_id': '2', 'value': '8063.09', 'value_creation_timestamp': '1387324800000'},
     {'business_day': '20131218', 'snapshot_type': 'EOD', 'snapshot_time': '23:00', 'snapshot_date': '20131218',
      'unique_contract_id': '11', 'value': '5882.11', 'value_creation_timestamp': '1387324800000'},
     {'business_day': '20131218', 'snapshot_type': 'EOD', 'snapshot_time': '23:00', 'snapshot_date': '20131218',
      'unique_contract_id': '36', 'value': '3305.77', 'value_creation_timestamp': '1387324800000'},
     {'business_day': '20131218', 'snapshot_type': 'EOD', 'snapshot_time': '23:00', 'snapshot_date': '20131218',
      'unique_contract_id': '39', 'value': '5376.59', 'value_creation_timestamp': '1387324800000'},
     {'business_day': '20131218', 'snapshot_type': 'EOD', 'snapshot_time': '23:00', 'snapshot_date': '20131218',
      'unique_contract_id': '14', 'value': '9499.1', 'value_creation_timestamp': '1387324800000'},
     {'business_day': '20131218', 'snapshot_type': 'EOD', 'snapshot_time': '23:00', 'snapshot_date': '20131218',
      'unique_contract_id': '16', 'value': '9213.1', 'value_creation_timestamp': '1387324800000'},
     {'business_day': '20131218', 'snapshot_type': 'EOD', 'snapshot_time': '23:00', 'snapshot_date': '20131218',
      'unique_contract_id': '19', 'value': '7675.98', 'value_creation_timestamp': '1387324800000'},
     {'business_day': '20131218', 'snapshot_type': 'EOD', 'snapshot_time': '23:00', 'snapshot_date': '20131218',
      'unique_contract_id': '15', 'value': '8111.65', 'value_creation_timestamp': '1387324800000'},
     {'business_day': '20131218', 'snapshot_type': 'EOD', 'snapshot_time': '23:00', 'snapshot_date': '20131218',
      'unique_contract_id': '17', 'value': '3959.36', 'value_creation_timestamp': '1387324800000'},
     {'business_day': '20131218', 'snapshot_type': 'EOD', 'snapshot_time': '23:00', 'snapshot_date': '20131218',
      'unique_contract_id': '24', 'value': '9506.47', 'value_creation_timestamp': '1387324800000'},
     {'business_day': '20131218', 'snapshot_type': 'EOD', 'snapshot_time': '23:00', 'snapshot_date': '20131218',
      'unique_contract_id': '4', 'value': '8792.34', 'value_creation_timestamp': '1387324800000'},
     {'business_day': '20131218', 'snapshot_type': 'EOD', 'snapshot_time': '23:00', 'snapshot_date': '20131218',
      'unique_contract_id': '35', 'value': '5922.5', 'value_creation_timestamp': '1387324800000'},
     {'business_day': '20131218', 'snapshot_type': 'EOD', 'snapshot_time': '23:00', 'snapshot_date': '20131218',
      'unique_contract_id': '9', 'value': '544.22', 'value_creation_timestamp': '1387324800000'},
     {'business_day': '20131218', 'snapshot_type': 'EOD', 'snapshot_time': '23:00', 'snapshot_date': '20131218',
      'unique_contract_id': '12', 'value': '7357.75', 'value_creation_timestamp': '1387324800000'},
     {'business_day': '20131218', 'snapshot_type': 'EOD', 'snapshot_time': '23:00', 'snapshot_date': '20131218',
      'unique_contract_id': '18', 'value': '69.15', 'value_creation_timestamp': '1387324800000'},
     {'business_day': '20131218', 'snapshot_type': 'EOD', 'snapshot_time': '23:00', 'snapshot_date': '20131218',
      'unique_contract_id': '3', 'value': '2795.01', 'value_creation_timestamp': '1387324800000'},
     {'business_day': '20131218', 'snapshot_type': 'EOD', 'snapshot_time': '23:00', 'snapshot_date': '20131218',
      'unique_contract_id': '1', 'value': '2806.79', 'value_creation_timestamp': '1387324800000'},
     {'business_day': '20131218', 'snapshot_type': 'EOD', 'snapshot_time': '23:00', 'snapshot_date': '20131218',
      'unique_contract_id': '37', 'value': '4175.82', 'value_creation_timestamp': '1387324800000'},
     {'business_day': '20131218', 'snapshot_type': 'EOD', 'snapshot_time': '23:00', 'snapshot_date': '20131218',
      'unique_contract_id': '31', 'value': '5470.1', 'value_creation_timestamp': '1387324800000'},
     {'business_day': '20131218', 'snapshot_type': 'EOD', 'snapshot_time': '23:00', 'snapshot_date': '20131218',
      'unique_contract_id': '13', 'value': '1717.32', 'value_creation_timestamp': '1387324800000'},
     {'business_day': '20131218', 'snapshot_type': 'EOD', 'snapshot_time': '23:00', 'snapshot_date': '20131218',
      'unique_contract_id': '30', 'value': '3199.17', 'value_creation_timestamp': '1387324800000'},
     {'business_day': '20131218', 'snapshot_type': 'EOD', 'snapshot_time': '23:00', 'snapshot_date': '20131218',
      'unique_contract_id': '32', 'value': '5064.21', 'value_creation_timestamp': '1387324800000'},
     {'business_day': '20131218', 'snapshot_type': 'EOD', 'snapshot_time': '23:00', 'snapshot_date': '20131218',
      'unique_contract_id': '29', 'value': '385.28', 'value_creation_timestamp': '1387324800000'},
     {'business_day': '20131218', 'snapshot_type': 'EOD', 'snapshot_time': '23:00', 'snapshot_date': '20131218',
      'unique_contract_id': '34', 'value': '6697.84', 'value_creation_timestamp': '1387324800000'},
     {'business_day': '20131218', 'snapshot_type': 'EOD', 'snapshot_time': '23:00', 'snapshot_date': '20131218',
      'unique_contract_id': '41', 'value': '6693.61', 'value_creation_timestamp': '1387324800000'},
     {'business_day': '20131218', 'snapshot_type': 'EOD', 'snapshot_time': '23:00', 'snapshot_date': '20131218',
      'unique_contract_id': '25', 'value': '3059.76', 'value_creation_timestamp': '1387324800000'},
     {'business_day': '20131218', 'snapshot_type': 'EOD', 'snapshot_time': '23:00', 'snapshot_date': '20131218',
      'unique_contract_id': '6', 'value': '3975.4', 'value_creation_timestamp': '1387324800000'},
     {'business_day': '20131218', 'snapshot_type': 'EOD', 'snapshot_time': '23:00', 'snapshot_date': '20131218',
      'unique_contract_id': '33', 'value': '8611.66', 'value_creation_timestamp': '1387324800000'},
     {'business_day': '20131218', 'snapshot_type': 'EOD', 'snapshot_time': '23:00', 'snapshot_date': '20131218',
      'unique_contract_id': '22', 'value': '6995.45', 'value_creation_timestamp': '1387324800000'},
     {'business_day': '20131218', 'snapshot_type': 'EOD', 'snapshot_time': '23:00', 'snapshot_date': '20131218',
      'unique_contract_id': '10', 'value': '1416.18', 'value_creation_timestamp': '1387324800000'},
     {'business_day': '20131218', 'snapshot_type': 'EOD', 'snapshot_time': '23:00', 'snapshot_date': '20131218',
      'unique_contract_id': '42', 'value': '6990.41', 'value_creation_timestamp': '1387324800000'},
     {'business_day': '20131218', 'snapshot_type': 'EOD', 'snapshot_time': '23:00', 'snapshot_date': '20131218',
      'unique_contract_id': '28', 'value': '4920.89', 'value_creation_timestamp': '1387324800000'},
     {'business_day': '20131218', 'snapshot_type': 'EOD', 'snapshot_time': '23:00', 'snapshot_date': '20131218',
      'unique_contract_id': '26', 'value': '4515.56', 'value_creation_timestamp': '1387324800000'},
     {'business_day': '20131218', 'snapshot_type': 'EOD', 'snapshot_time': '23:00', 'snapshot_date': '20131218',
      'unique_contract_id': '5', 'value': '9173.21', 'value_creation_timestamp': '1387324800000'},
     {'business_day': '20131218', 'snapshot_type': 'EOD', 'snapshot_time': '23:00', 'snapshot_date': '20131218',
      'unique_contract_id': '8', 'value': '3573.52', 'value_creation_timestamp': '1387324800000'},
     {'business_day': '20131218', 'snapshot_type': 'EOD', 'snapshot_time': '23:00', 'snapshot_date': '20131218',
      'unique_contract_id': '20', 'value': '1069.93', 'value_creation_timestamp': '1387324800000'},
     {'business_day': '20131218', 'snapshot_type': 'EOD', 'snapshot_time': '23:00', 'snapshot_date': '20131218',
      'unique_contract_id': '38', 'value': '8066.47', 'value_creation_timestamp': '1387324800000'},
     {'business_day': '20131218', 'snapshot_type': 'EOD', 'snapshot_time': '23:00', 'snapshot_date': '20131218',
      'unique_contract_id': '40', 'value': '7181.03', 'value_creation_timestamp': '1387324800000'},
     {'business_day': '20131218', 'snapshot_type': 'EOD', 'snapshot_time': '23:00', 'snapshot_date': '20131218',
      'unique_contract_id': '23', 'value': '1323.82', 'value_creation_timestamp': '1387324800000'},
     {'business_day': '20131218', 'snapshot_type': 'EOD', 'snapshot_time': '23:00', 'snapshot_date': '20131218',
      'unique_contract_id': '27', 'value': '5000.9', 'value_creation_timestamp': '1387324800000'},
     {'business_day': '20131218', 'snapshot_type': 'EOD', 'snapshot_time': '23:00', 'snapshot_date': '20131218',
      'unique_contract_id': '7', 'value': '5896.33', 'value_creation_timestamp': '1387324800000'}]

d1 = [{'name': "Tom", 'id': 10}, {'name': "Mark", 'id': 5}, {'name': "Pam", 'id': 7}, {'name': "Pam", 'id': 8},
      {'name': "Tom2", 'id': 100}]
d2 = [{'name': "Tom", 'id': 10}, {'name': "Mark", 'id': 15}, {'name': "Pam", 'id': 17}, {'name': "Pam", 'id': 18},
      {'name': "Tom3", 'id': 100}]

people = [
    {'id': 0, 'name': "Tom", 'age': 10},
    {'id': 2, 'name': "Pam", 'age': 7},
    {'id': 1, 'name': "Mark", 'age': 5},
    {'id': 3, 'name': "Pam", 'age': 8}
    , {'id': 200, 'name': "XX", 'age': 99}
]

sex = [
    {'id': 0, 'sex': "M", 'driver': "Y"},
    {'id': 1, 'sex': "M", 'driver': "N"},
    {'id': 2, 'sex': "F", 'driver': "Y"},
    {'id': 3, 'sex': "F", 'driver': "N"}
    , {'id': 300, 'sex': "x", 'driver': "x"}
    , {'id': 300, 'color': "red"}
]

from numpy import unique, intersect1d
from re import compile
from collections import defaultdict

l = list(d1[0].keys())
print(l)
# class FakeSQL:
#     def check_null_unique(self, data, not_null: bool, is_unique: bool, raise_error=True, message=""):
#         msg = None
#         if len(data) == 0 and not_null:
#             msg = "Data are empty. " + message
#         if len(data) > 1 and is_unique:
#             msg = f"More than one expected list item found. Count records:{len(data)}. {message}"
#         if raise_error and msg is not None:
#             raise ValueError(msg)
#         elif msg is not None:
#             print("ERROR " + msg)
#
#     def select_column(self, data, column, where_value=None):
#         c: list = [x[column] for x in data]
#         if where_value:
#             r = compile(where_value)
#             list(filter(r.match, c))
#         return c
#
#     def select_col1_where_col2(self, data: list[dict], select_column1, where_column2, where_value, not_null=True,
#                                is_unique=True,
#                                raise_error=True):
#         row = list(filter(lambda x: x[where_column2] == where_value, data))
#         self.check_null_unique(row, not_null, is_unique, raise_error, f"Condition: {where_column2}  = '{where_value}'")
#         if is_unique:
#             return row[0][select_column1]
#         else:
#             return row
#
#     def outer_join(self, key, *datas):
#         dx = []
#         for data in datas:
#             dn = self.select_column(data, key)
#             dx = sorted(unique(dx + dn))
#         return dx
#
#     def inner_join(self, key, *datas):
#         dx = self.select_column(datas[0], key)
#         for data in datas[1:]:
#             dn = self.select_column(data, key)
#             dx = sorted(list(intersect1d(dx, dn)))
#         return dx
#
#     def left_join_dictionary(self, index, data1, data2):
#         pass
#
#     def inner_join_dictionary(self, index, data1, data2):
#         pass
#
#     def outer_join_dictionary(self, index, data1, data2):
#         dx = defaultdict(dict)
#         for row in (data1, data2):
#             for elem in row:
#                 dx[elem[index]].update(elem)
#         dxl = list(dx.values())
#         dxl = self.add_missing_pairs(dxl)
#         return dxl
#
#     def add_missing_pairs(self, data, default_value=None):
#         cnt = 0
#         columns: list = []
#         for row in data:
#             columns = columns + list(row.keys())
#         for i_row in range(len(data)):
#             for col in columns:
#                 if not col in data[i_row]:
#                     data[i_row][col] = default_value
#                     cnt += 1
#         print(f"INFO Added {cnt} missing pairs to create square dictionary.")
#         return data
#
#     def drop_columns(self, data, *columns):
#         pass
#
#     def rename_columns(self, data, *columns):
#         pass
#
#     def delete_rows(self, data, where_column, where_values: list):
#         pass
#
#
# fsql = FakeSQL()
# print(fsql.select_column(people, "name"))
# print(fsql.select_column(d, "unique_contract_id"))
# print(fsql.select_col1_where_col2(people, "age", "name", "Tom"))
# print(fsql.select_col1_where_col2(people, "age", "name", "Pam", raise_error=False))
# print(fsql.outer_join('id', d1, d2))
# print(fsql.inner_join('id', d1, d2))
# print(fsql.outer_join_dictionary("id", people, sex))
